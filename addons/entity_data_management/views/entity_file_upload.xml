from odoo import models, fields, api, _
from odoo.exceptions import UserError
import base64
import os

class EntityFileUpload(models.TransientModel):
    _name = 'entity.file.upload'
    _description = 'Upload CSV File'

    file = fields.Binary(string="File", required=True)
    filename = fields.Char(string="File Name", required=True)

    def action_upload_file(self):
        for record in self:
            if record.file and record.filename:
                try:
                    file_content = base64.b64decode(record.file)
                    file_path = f"/mnt/data/{record.filename}"
                    with open(file_path, 'wb') as f:
                        f.write(file_content)
                    self.env['entity.data'].process_file(file_path, 'user')
                except Exception as e:
                    raise UserError(_('Failed to upload and process file: %s') % str(e))
